import numpy as np
import pandas as pd

from sklearn.metrics import mean_squared_error
from sklearn.linear_model import LinearRegression
from sklearn.svm import SVR
from sklearn.model_selection import train_test_split

import xgboost as xgb

## 読み込み
df_train = pd.read_csv("train.csv")
df_test = pd.read_csv("test.csv")

## xの前処理
num_cols = ['GrLivArea','YearBuilt','TotalBsmtSF']
cat_cols = ["BsmtQual", "OverallQual", 'OverallCond',"GarageCars", "Utilities"]
df_x = pd.concat([df_train.iloc[:,:-1], df_test], axis=0)
df_x = pd.concat([df_x[num_cols], pd.get_dummies(df_x[cat_cols])], axis=1)
df_train_x = df_x.iloc[:df_train.shape[0],:]
df_test_x  = df_x.iloc[df_train.shape[0]:,:]

## yの準備
df_train_y = df_train["SalePrice"]

## モデルの準備
clf = xgb.XGBRegressor(
learning_rate=0.01,
n_estimators=10000,
max_depth=6
)

## 学習
clf.fit(df_train_x, np.log(df_train_y))

## 予測
y_pred = clf.predict(df_test_x.fillna(0))

## 保存
pred_df = pd.DataFrame(np.exp(y_pred), index=df_test["Id"], columns=["SalePrice"])
pred_df.to_csv('./mb.csv', header=True, index_label='Id')
